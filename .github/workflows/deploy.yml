name: Deploy Redesign

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Sync Theme Files
        uses: Burnett01/rsync-deployments@7.0.1
        with:
          # -avzr syncs files; we EXCLUDE the .git folder
          # We do NOT use --delete so we don't accidentally wipe the server core
          switches: -avzr --exclude='.git*'
          path: ./
          remote_path: /var/www/vhosts/vipartesanias.ubbie.studio/httpdocs/
          remote_host: 148.251.42.8
          remote_user: ubbie_vipartesanias
          remote_key: ${{ secrets.SERVER_SSH_KEY }}

      - name: Clear Smarty Cache
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: 148.251.42.8
          username: ubbie_vipartesanias
          key: ${{ secrets.SERVER_SSH_KEY }}
          script: |
            # Forces PrestaShop to see your HTML/CSS changes
            rm -rf /var/www/vhosts/vipartesanias.ubbie.studio/httpdocs/var/cache/prod/smarty/compile/*
            echo "Design cache cleared successfully!"